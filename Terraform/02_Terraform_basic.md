# ν…λΌνΌ κΈ°μ΄

## κµ¬μ„±μ”μ†

1. provider

    μƒμ„±ν•  μΈν”„λΌμ μΆ…λ¥λ¥Ό μλ―Έν•λ‹¤. λ§μ•½ AWS μΈν”„λΌλ¥Ό κµ¬μ„±ν•λ ¤κ³  ν•λ‹¤λ©΄, providerλ” awsκ°€ λ  κ²ƒμ΄λ‹¤. μ•„λμ μ½”λ“λ¥Ό ν†µν•΄ μƒμ„±λ providerλ” AWSμ λ¦¬μ†μ¤μ— μ ‘κ·Όν•κΈ° μ„ν• credentials λ“±μ νμΌμ„ λ‹¤μ΄λ°›λ” μ—­ν• μ„ μν–‰ν•λ‹¤.

    ```terraform
    provider "aws" {
        region = "ap-northeast-2"
        version = "~> 3.0"
    }
    ```

2. resource

    μ‹¤μ λ΅ μƒμ„±ν•  μΈν”„λΌμ μμ›μ„ λ…μ‹ν•λ” κ²ƒμΌλ΅, `.tf` ν™•μ¥μλ¥Ό κ°€μ§„λ‹¤.

    ```terraform
    resource "aws_vpc" "example" {
        cidr_block = "10.0.0.0/16"
    }
    ```
    - AWSμ VPCλ¥Ό μƒμ„±ν•λ” μ½”λ“μ΄λ‹¤.
    - cidr_block μ™Έμ—λ„ μ„¤μ •ν•  μ μλ” Argumentκ°€ λ‹¤μ–‘ν•κ² μ΅΄μ¬ν•λ‹¤.
    - `example`μ€ μƒμ„±ν• VPCμ μ΄λ¦„μ΄λ‹¤.

3. state

    μ‹¤μ λ΅ ν…λΌνΌ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•μ€μ„ λ• μƒμ„±λλ” κ²°κ³Όλ¬Όλ΅, `.tfstate` ν™•μ¥μλ¥Ό κ°€μ§€λ” νμΌμ΄λ‹¤. μ£Όμν•  μ μ€ state νμΌμ— μ €μ¥λ κ°’μ΄ μ‹¤μ  μΈν”„λΌ μμ›μ μƒνƒλ¥Ό μλ―Έν•λ” κ²ƒμ€ μ•„λ‹λΌλ” κ²ƒμ΄λ‹¤. κ·Έλμ„ state νμΌκ³Ό μ‹¤μ  μΈν”„λΌ μƒνƒλ¥Ό λ™μΌν•κ² μ μ§€ν•λ” κ²ƒμ΄ μ¤‘μ”ν• μ‘μ—…μ΄λ‹¤.

    ```terraform
    {
        "version": 4,
        "terraform_version": "0.12.24",
        "serial": 3,
        "lineage": "3c77XXXX-2de4-7736-1447-038974a3c187",
        "output": {},
        "resources":[
            {...},
            {...}
        ]
    }
    ```
    - μ§€κΈμ€ ν•νƒλ§ λ³΄κ³  λ„μ–΄κ°€κ³  λ‚μ¤‘μ— λ‹¤μ‹ μμ„Έν•κ² μ‚΄ν΄λ³Ό κ²ƒμ΄λ‹¤.

4. output

    μƒμ„±ν• μμ›μ„ λ³€μ ν•νƒλ΅ state νμΌμ— μ €μ¥ν•λ” κ²ƒμ΄λ‹¤. μ΄λ” remoteλ΅ μ°Έμ΅°λ  μ μλ‹¤.

    ```terraform
    resource "aws_vpc" "example" {
        cidr_block = "10.0.0.0/16"
    }

    output "vpc_id" {
        value = aws_vpc.example.id
    }

    output "cidr_block" {
        value = aws_vpc.example.cidr_block
    }
    ```
    - μ΄μ „μ— μƒμ„±ν• VPCμ idμ™€ cidr_blockμ„ κ°€μ Έμ™€μ„ λ³€μμ— μ €μ¥ν•λ” μμ μ΄λ‹¤.

5. module

    ν• λ² λ§λ“¤μ–΄μ§„ ν…λΌνΌ μ½”λ“λ¥Ό κ°™μ€ ν•νƒλ΅ λ°λ³µμ μΌλ΅ λ§λ“¤μ–΄λ‚Ό λ• μ‚¬μ©ν•λ‹¤. μμ›μ μ¬μ‚¬μ©μ— κ°•μ μ΄ μλ‹¤.

    ```terraform
    module "vpc" {
        source = "../_modules/vpc"

        cidr_block = "10.1.0.0/16"
    }
    ```
    - VPCλ¥Ό cidr_blockλ§ λ‹¤λ¥΄κ² ν•μ—¬ λ‹¤μ‹ μƒμ„±ν•΄μ•Ό ν•  λ• μ‚¬μ©λ  μ μλ‹¤.

6. remote

    λ‹¤λ¥Έ κ²½λ΅μ state νμΌμ—μ„ output λ³€μλ¥Ό λ¶λ¬μ¬ λ• μ‚¬μ©λλ‹¤. (μ›κ²© μ°Έμ΅°)


    μ•„λλ” remoteλ¥Ό μƒμ„±ν•λ” μ½”λ“μ΄λ‹¤.

    ```terraform
    data "terraform_remote_state" "vpc" {
        backend = "s3"

        config = {
            bucket = "terraform-s3-bucket"
            region = "ap-northeast-2"
            key = "terraform/vpc/terraform.tfstate"
        }
    }
    ```
    - s3 λ²„ν‚·μ— μ €μ¥λμ–΄ μλ” .tfstate νμΌμ„ μ°Έμ΅°ν•λ” remoteμ΄λ‹¤.
    - key κ°’μ— λ…μ‹λμ–΄ μλ” state νμΌμ—μ„ output λ³€μλ“¤μ„ κ°€μ Έμ¤λ” remote μΈ κ²ƒμ΄λ‹¤.
    - `vpc`λ” remoteμ κ³ μ ν• μ΄λ¦„μ„ μλ―Έν•λ‹¤.
    
    μ•„λλ” μ‹¤μ λ΅ remoteλ¥Ό μ‚¬μ©ν•λ” μ½”λ“μ΄λ‹¤.

    ```terraform
    output "vpc_id" {
        value = aws_vpc.example.id
    }

    resource "aws_instance" "example" {
        vpc_id = data.terraform_remote_state.vpc.outputs.vpc_id
    }
    ```
    - μ•μ„ μƒμ„±ν• remoteλ” `terraform/vpc/terraform.tfstate` ν•΄λ‹Ή νμΌμ„ μ°Έμ΅°ν•κ³  μμ—λ‹¤. ν•΄λ‹Ή νμΌμ— `vpc_id`λΌλ” output λ³€μκ°€ μλ‹¤κ³  κ°€μ •ν•΄λ³΄μ.
    - κ·Έλ¬λ©΄ μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±ν•  λ•μ— remoteλ¥Ό μ΄μ©ν•μ—¬ `vpc_id` λ³€μλ¥Ό λ¶λ¬μ¬ μ μλ‹¤.

7. backend

    state νμΌμ„ μ €μ¥ν•λ” κ³µκ°„μ„ μλ―Έν•λ‹¤. λ€ν‘μ μΌλ΅ AWS S3κ°€ μλ‹¤.


## κΈ°λ³Έ λ…λ Ήμ–΄

1. init

    ν…λΌνΌμ λ…λ Ήμ–΄λ“¤μ„ μ‚¬μ©ν•κΈ° μ„ν•΄ μµμ΄μ— μ‹¤ν–‰λμ–΄μ•Ό ν•λ” λ…λ Ήμ–΄μ΄λ‹¤. λ‚΄λ¶€μ μΌλ΅ providerμ™€ state, module λ“± κ°μΆ… μ„¤μ •μ΄ μ§„ν–‰λλ‹¤.

2. plan

    ν…λΌνΌμΌλ΅ μ‘μ„±λ μ½”λ“κ°€ μ‹¤μ λ΅ μ–΄λ–»κ² μμ›μΌλ΅ λ§λ“¤μ–΄μ§ μ§€μ— λ€ν• μμΈ΅ κ²°κ³Όλ¥Ό λ³΄μ—¬μ£Όλ” λ…λ Ήμ–΄μ΄λ‹¤. μ‹¤μ λ΅ κ°€μ¥ λ§μ΄ μ‚¬μ©λλ” λ…λ Ήμ–΄μΌ κ²ƒμ΄λ‹¤.

3. apply

    ν…λΌνΌ μ½”λ“λ¥Ό μ‹¤ν–‰ν•μ—¬ μ‹¤μ  μΈν”„λΌλ¥Ό μƒμ„±ν•λ” λ…λ Ήμ–΄μ΄λ‹¤. μ΄λ” μ•„μ£Ό μ£Όμν•μ—¬ μ‹¤ν–‰ν•μ—¬μ•Ό ν•λ‹¤.

4. import

    μ΄λ―Έ λ§λ“¤μ–΄μ Έ μλ” μμ›μ„ μ½”λ“λ΅ λ§λ“¤μ–΄ state νμΌλ΅ μ®κ²¨μ£Όλ” λ…λ Ήμ–΄μ΄λ‹¤. κΈ°μ΅΄μ— route53μ΄λΌλ” μμ›μ„ λ§λ“¤μ—λ‹¤κ³  κ°€μ •ν•λ©΄, μ΄λ¥Ό λ¶λ¬μ™€ μ‚¬μ©ν•  μ μλ‹¤λ” κ²ƒμ΄λ‹¤.

5. state

    state νμΌμ„ λ‹¤λ£¨λ” λ…λ Ήμ–΄μ΄λ‹¤. `mv`, `push`μ™€ κ°™μ€ ν•μ„ λ…λ Ήμ–΄κ°€ μ΅΄μ¬ν•λ‹¤.

6. destroy

    μƒμ„±λ μμ›μ„ state νμΌμ„ κΈ°μ¤€μΌλ΅ ν•μ—¬ λ¨λ‘ μ‚­μ ν•λ” λ…λ Ήμ–΄μ΄λ‹¤. μ¦‰ ν…λΌνΌμΌλ΅ μƒμ„±ν• μμ›λ§μ„ μ‚­μ ν•λ‹¤. μ‚­μ ν•κ³  μƒλ΅­κ² λ§λ“¤κ³  μ‹¶μ€ κ²½μ°μ— μ‚¬μ©ν•λ©΄ μΆ‹λ‹¤.


## λ…λ Ήμ–΄ μ‚¬μ© ν”„λ΅μ„Έμ¤

> ν…λΌνΌ μ½”λ“ μ‘μ„± -> init -> plan -> apply

λ³΄ν†µ λ‹¤μκ³Ό κ°™μ€ λ‹¨κ³„λ΅ μ§„ν–‰λλ‹¤.

1. μ‹¤ν–‰ν•  ν…λΌνΌ μ½”λ“λ¥Ό μ‘μ„±ν•λ‹¤.

2. ν…λΌνΌ λ…λ Ήμ–΄λ“¤μ„ μ‚¬μ©ν•κΈ° μ„ν•΄ `init` λ…λ ΉμΌλ΅ ν™κ²½ μ„¤μ •μ„ ν•΄μ¤€λ‹¤.

3. μ‹¤ν–‰ κ²°κ³Όλ¥Ό μμΈ΅ν•κΈ° μ„ν•΄ `plan` λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•λ‹¤. planμ κ²°κ³Όμ—μ„ μ¤λ¥κ°€ μ—†μ–΄μ•Ό μ‹¤μ λ΅ μ‹¤ν–‰ν–μ„ λ• μ¤λ¥κ°€ μ—†μ„ ν™•λ¥ μ΄ λ†’λ‹¤. ν•μ§€λ§ planμ΄ 100% μ¤λ¥κ°€ μ—†μμ„ λ³΄μ¥ν•΄μ£Όμ§€λ” μ•λ”λ‹¤. μμΈ΅ κ²°κ³ΌμΌ λΏ ν•­μƒ μ¬λ°”λ¥΄κ² λ™μ‘ν•λ‹¤κ³  μ¥λ‹΄ν•  μλ” μ—†κΈ° λ•λ¬Έμ΄λ‹¤. 

4. `apply`λ¥Ό ν†µν•΄ μ½”λ“λ¥Ό μ‹¤ν–‰ν•μ—¬ μ‹¤μ  μμ›μ„ μƒμ„±ν•λ‹¤. applyλ” μ‹¤μ λ΅ μΈν”„λΌμ— μν–¥μ„ λ―ΈμΉκΈ° λ•λ¬Έμ— μ‹¤ν–‰μ— μ μν•΄μ•Ό ν•λ©°, apply ν•κΈ° μ „μ— planμ„ ν•λ” μµκ΄€μ„ λ“¤μ—¬μ•Ό ν•λ‹¤.

## ν…λΌνΌ μ‘λ™ μ›λ¦¬

ν…λΌνΌμ€ ν¬κ² 3κ°€μ§€λ΅ κµ¬μ„±λμ–΄ μλ‹¤.

1. λ΅μ»¬μ—μ„ μ‘μ„±ν• μ½”λ“
2. μ½”λ“λ¥Ό ν†µν•΄ λ§λ“¤μ–΄μ§„ μ‹¤μ  AWS μΈν”„λΌ
3. λ°±μ—”λ“μ— μ €μ¥λλ” state νμΌ

κ·Έλμ„ μ΄ 3κ°€μ§€ κµ¬μ„±μ”μ† κ°„μ νλ¦„μ„ μ΄ν•΄ν•λ” κ²ƒμ΄ μ¤‘μ”ν•λ‹¤.

μ½”λ“λ¥Ό ν†µν•΄ λ§λ“¤μ–΄μ§€λ” μ‹¤μ  AWS μΈν”„λΌμ™€ λ°±μ—”λ“μ— μ €μ¥λ state νμΌμ΄ 100% μΌμΉν•λ„λ΅ λ§λ“λ” κ²ƒμ΄ μ¤‘μ”ν•λ‹¤. λ§μ•½ state νμΌμ„ λ³€κ²½ν• ν›„ λ°μν–λ”λ° λ‹¤λ¥Έ κ°λ°μμ™€μ μ‹±ν¬κ°€ λ§μ§€ μ•κ±°λ‚, μƒμ„±λ AWS μΈν”„λΌλ¥Ό μ½μ†”λ΅ λ³€κ²½ν•λ ¤κ³  ν•κ±°λ‚, λ°±μ—”λ“μ— μ €μ¥λ stateλ¥Ό μ„μλ΅ λ³€κ²½ν•λ ¤κ³  ν•λ‹¤λ©΄ μΌμΉν•μ§€ μ•λ” κ²½μ°κ°€ μƒκΈΈ μλ„ μλ‹¤.

μ΄λ¥Ό μΌμΉμ‹ν‚¤κΈ° μ„ν•΄ μ§€μ†μ μΌλ΅ `plan - apply`λ¥Ό ν•λ” κ²ƒμ΄ μ¤‘μ”ν•λ‹¤. μ‹¤μ λ΅ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•΄λ³΄λ©΄μ„ μ‘λ™ μ›λ¦¬λ¥Ό μ΄ν•΄ν•΄λ³΄μ.

### Init

init λ…λ Ήμ–΄λ¥Ό ν•κΈ° μ„ν•΄μ„λ” ν…λΌνΌ μ½”λ“κ°€ μ΅΄μ¬ν•΄μ•Ό ν•λ‹¤. κ·Έλμ„ provider μ½”λ“λ¥Ό μ‘μ„±ν•΄λ³Ό κ²ƒμ΄λ‹¤.

```terraform
provider "aws" {
    region = "ap-northeast-2"
}
```
providerλ” μ–΄λ–¤ μΈν”„λΌλ¥Ό ν…λΌνΌμΌλ΅ λ‹¤λ£° μ§€μ— λ€ν• λ‚΄μ©μ„ λ‹΄κ³  μλ‹¤. AWSλ¥Ό μ‚¬μ©ν•κ³  λ¦¬μ „μ„ μ„μΈλ΅ μ§€μ •ν•μ€λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/2c87754e-2c45-4a16-9a1f-f0aeddf746be)

μ΄μ  initμ„ μ§„ν–‰ν•λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/9e7f5153-c2b0-4320-a9a5-56e8406371a2)

κ·Έλ¬λ©΄ providerλ΅ μ§€μ •ν• AWS κ΄€λ ¨ μ„¤μ •μ΄ μ΄λ£¨μ–΄μ§„λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/9aca1fe2-1fdc-4461-8e34-3c8cf98eae39)

initμ κ²°κ³Όλ¬Όλ΅ `.terraform` ν΄λ”κ°€ μƒμ„±λμ—λ‹¤. ν…λΌνΌ λ‚΄λ¶€μ μΌλ΅ AWSμ APIλ¥Ό νΈμ¶ν•μ—¬ μΈν”„λΌλ¥Ό μƒμ„±ν•κ³  λ³€κ²½ν•κΈ° λ•λ¬Έμ— AWSμ APIλ¥Ό νΈμ¶ν•κΈ° μ„ν• λΌμ΄λΈλ¬λ¦¬λ¥Ό μ„¤μΉν•λ” μ‘μ—…λ„ μ§„ν–‰ν•΄μ•Ό ν•λ”λ°, init λ…λ Ήμ–΄κ°€ κ·Έ μ—­ν• μ„ λ‹΄λ‹Ήν•λ‹¤.


### Plan

μ΄μ  μ‹¤μ  μΈν”„λΌλ¥Ό μƒμ„±ν•΄λ³Ό κ²ƒμ΄λ‹¤.

```terraform
resource "aws_s3_bucket" "test" {
    bucket = "terraform101-inflearn-jiwoo"
}
```

λ¦¬μ†μ¤ νμΌμ„ μƒμ„±ν•΄μ¤€λ‹¤. μ΄λ” `terraform101-inflearn-jiwoo`λΌλ” μ΄λ¦„μ S3 λ²„ν‚·μ„ μƒμ„±ν•λ” `test` λ¦¬μ†μ¤ μ½”λ“μ΄λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/30359880-b3cb-4764-9ec8-a2e627e96a43)

μ΄λ¥Ό μ μ©ν•κΈ° μ „μ— planμ„ ν†µν•΄ μμΈ΅ κ²°κ³Όλ¥Ό ν™•μΈν•΄λ³΄λ©΄ λ‹¤μκ³Ό κ°™λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/fb1e8ca3-fa39-4960-a011-82602d495a08)

ν•΄λ‹Ή λ¦¬μ†μ¤ μ½”λ“λ΅ S3 λ²„ν‚· ν•λ‚κ°€ μƒμ„±λ  κ²ƒμ΄λΌκ³  μμΈ΅ν•μ€λ‹¤. plan λ…λ Ήμ–΄λ” μ‹¤μ  μΈν”„λΌμ— μ•„λ¬΄λ° μν–¥μ„ μ£Όμ§€ μ•λ”λ‹¤.


### Apply

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/caed443c-ef60-4d06-9326-a454476535ef)
![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/1d771fb6-6121-44c7-8f77-b51fa03fe1e4)

apply λ…λ Ήμ–΄λ¥Ό ν†µν•΄ μ‹¤μ  μΈν”„λΌλ¥Ό λ°°ν¬ν•μ€λ‹¤. λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•κΈ° μ„ν•΄μ„λ” μ¤‘κ°„μ— `yes`λ¥Ό μλ™μΌλ΅ μ…λ ¥ν•΄μ•Ό ν•λ‹¤. μ΄λ” λ…λ Ήμ–΄λ¥Ό μλ» μ…λ ¥ν• κ²½μ°λ¥Ό λ°©μ§€ν•κΈ° μ„ν•΄μ„μ΄λ‹¤. μ‹¤μ  μΈν”„λΌμ— μν–¥μ„ μ¤„ μ μλ” λ…λ Ήμ–΄μ΄κΈ° λ•λ¬Έμ— ν•­μƒ μ£Όμν•  ν•„μ”κ°€ μλ‹¤.

apply λ…λ Ήμ„ μν–‰ν•κ³  λ‚λ©΄ μΈν”„λΌκ°€ μ‹¤μ λ΅ μƒμ„±λκ³ , μΈν”„λΌμ μƒνƒ μ •λ³΄λ¥Ό μ €μ¥ν•λ” state νμΌμ΄ λ°±μ—”λ“μ— μ €μ¥λλ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/e2d68156-010c-4d8a-b862-dee87631e534)

AWS μ½μ†”μ„ ν†µν•΄ μƒμ„±λ S3 λ²„ν‚·μ„ ν™•μΈν•μ€λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/aa03203c-f7c7-4012-89d2-2da6168af5d4)

μƒμ„±λ state νμΌμ΄λ‹¤. λ°±μ—”λ“λ¥Ό λ”°λ΅ μ§€μ •ν•μ§€ μ•μ•κΈ° λ•λ¬Έμ— λ΅μ»¬μ— μ €μ¥λ κ²ƒμ΄λ‹¤.

### ν…λΌνΌμ΄ μΈν”„λΌλ¥Ό μΈμ‹ν•λ” λ°©λ²•

ν…λΌνΌμ€ ν…λΌνΌ λ…λ Ήμ–΄λ΅ λ§λ“¤μ–΄μ§„ λ¦¬μ†μ¤λ§μ„ μΈμ‹ν•  μ μλ‹¤. μΈμ‹ν•  μ μκ² ν•λ” λ°©λ²•μ΄ λ°”λ΅ state νμΌμ΄λ‹¤. κ·Έλ ‡λ‹¤λ©΄ state νμΌμ΄ μ‚­μ λλ‹¤λ©΄ μ–΄λ–¤ μΌμ΄ λ²μ–΄μ§κΉ?

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/6f50697f-4aff-4e80-8788-96ee25731a64)

state νμΌμ„ μ‚­μ ν• μƒνƒλ΅ planμ„ λ‹¤μ‹ μ§„ν–‰ν•΄λ³΄μ.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/bf64cc1a-43ce-400e-ab9c-c7a3dc6d3261)

μ΄λ―Έ μ΅΄μ¬ν•λ” `terraform101-inflearn-jiwoo` λ²„ν‚·μ„ λ‹¤μ‹ μƒμ„±ν•λ‹¤κ³  μμΈ΅ν•μ€λ‹¤. ν…λΌνΌμ΄ λ¦¬μ†μ¤λ¥Ό μΈμ‹ν•λ” λ°©λ²•μ΄ state νμΌμ΄κΈ° λ•λ¬Έμ— state νμΌμ΄ μ‚­μ λ ν„μ¬μ—λ” `terraform101-inflearn-jiwoo` λ²„ν‚·μ€ ν…λΌνΌμ—μ„ μΈμ‹ν•μ§€ λ»ν•λ” λ¦¬μ†μ¤κ°€ λ κ²ƒμ΄λ‹¤. κ·Έλμ„ λ¦¬μ†μ¤κ°€ μ‹¤μ λ΅ μ΅΄μ¬ν•λ” μ§€λ¥Ό μ•μ§€ λ»ν•κ³  `s3.tf` νμΌμ— μν•΄ μƒλ΅μ΄ λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•κ³ μ ν• κ²ƒμ΄λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/d575e286-bfb5-46fb-8755-9a3ae998ee95)

applyλ¥Ό ν•λ©΄ planμ μμΈ΅λ€λ΅ S3 λ²„ν‚·μ΄ μƒμ„±λμ§€ μ•λ”λ‹¤. μ΄λ―Έ λ™μΌν• μ΄λ¦„μ λ²„ν‚·μ΄ μ΅΄μ¬ν•κΈ° λ•λ¬Έμ΄λ‹¤. μ΄μ²λΌ planκ³Ό applyμ κ²°κ³Όλ” ν•­μƒ μΌμΉν•μ§€ μ•μ„ μ μμμ„ μ•κ³  μμ–΄μ•Ό ν•λ‹¤.

> plan - applyλ¥Ό μ§„ν–‰ν–μ„ λ• μ λ€λ΅ λ™μ‘ν•μ§€ μ•λ”λ‹¤λ©΄ μ–΄λ–¤ λ¬Έμ κ°€ μμ„ κ°€λ¥μ„±μ΄ μλ‹¤. μ„μ κ²½μ°μ—λ” μ‹¤μ  μΈν”„λΌλ” μ΅΄μ¬ν•λ”λ° state νμΌμ΄ μ—†μ–΄μ„ μƒκΈ΄ λ¬Έμ μ€λ‹¤. κ·Έλμ„ λ‹¤μ‹ state νμΌμ„ μƒμ„±ν•¨μΌλ΅μ¨ state νμΌκ³Ό μ‹¤μ  μΈν”„λΌλ¥Ό λ™μΌν•κ² μ μ§€ν•  ν•„μ”κ°€ μλ‹¤.

κ·Έλ¬λ©΄ μ‹¤μ  μΈν”„λΌκ°€ μ‚­μ λλ©΄ μ–΄λ–¤ μΌμ΄ λ²μ–΄μ§κΉ?

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/0279589d-fbe7-430a-9760-5155048eeb4f)

λ²„ν‚·μ„ μ‚­μ ν•΄λ³΄μ•λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/f11a984f-0efe-4988-ac08-ded929d51fc2)
![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/a513672b-b87a-4edd-af30-be456914a55c)

ν•μ§€λ§ state νμΌμ€ μ—¬μ „ν λ΅μ»¬μ— λ‚¨μ•„μλ‹¤. μ΄λ” ν…λΌνΌμ΄ ν•΄λ‹Ή λ²„ν‚·μ„ μ—¬μ „ν μΈμ‹ν•κ³  μλ‹¤λ” μλ―Έμ΄κΈ°λ„ ν•λ‹¤. λ‹¤μ‹ planμ„ μ³λ³΄μ.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/1d49869f-7058-41a2-b6f7-f8b0350dd7f7)

λ²„ν‚·μ„ μƒμ„±ν•λ‹¤κ³  λ‚μ¨λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/8343b3f7-0960-40fd-b979-92eb742ded23)

applyλ¥Ό ν•΄λ³΄λ©΄ μ „μ— μ‚­μ ν–λ S3 λ²„ν‚·μ΄ λ‹¤μ‹ μƒμ„±λμ—μμ„ ν™•μΈν•  μ μλ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/7c6778b3-4c68-4777-8e83-bbdf8196fa94)

μ΄μ²λΌ μ‹¤μλ΅ λ¦¬μ†μ¤λ¥Ό μ‚­μ ν•μ€λ”λΌλ„ ν…λΌνΌ μ½”λ“λ§ κ°€μ§€κ³  μ›λ μƒνƒλ΅ μ†μ‰½κ² λ³µκµ¬ν•  μ μλ‹¤. ν•μ§€λ§ state νμΌμ€ μ¤‘μ”ν•κΈ° λ•λ¬Έμ— μƒμ–΄λ²„λ¦¬μ§€ μ•κ² μ£Όμν•΄μ•Ό ν•  ν•„μ”κ°€ μμ„ κ²ƒ κ°™λ‹¤.

### Import

κ²°κµ­ ν…λΌνΌμ€ μΈν”„λΌμ μ •λ³΄λ¥Ό state νμΌλ΅ κ΄€λ¦¬ν•λ‹¤λ” κ²ƒμ„ μ•μ•λ‹¤. κ·Έλ¬λ©΄ μ΄λ―Έ μ΅΄μ¬ν•λ” μΈν”„λΌμ μƒνƒ μ •λ³΄λ¥Ό λ¶λ¬μ¤λ©΄ ν…λΌνΌμ΄ ν•΄λ‹Ή μΈν”„λΌλ¥Ό μΈμ‹ν•κ² ν•  μ μλ‹¤. μ‹¤μ  μΈν”„λΌλ¥Ό λ°”νƒ•μΌλ΅ state νμΌμ„ μƒμ„±ν•κΈ° μ„ν•΄μ„λ” `import` λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.

```terraform
terraform import aws_s3_bucket.test terraform101-inflearn-jiwoo
```

- test: λ¦¬μ†μ¤ μ΄λ¦„
- terraform101-inflearn-jiwoo: λ¶λ¬μ¬ S3 λ²„ν‚· μ΄λ¦„

importλ¥Ό ν•κΈ° μ„ν•΄μ„λ” λ΅μ»¬μ— λ¦¬μ†μ¤ νμΌμ΄ μ΅΄μ¬ν•΄μ•Ό ν•λ‹¤. λ¦¬μ†μ¤ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ state νμΌμ„ μƒμ„±ν•κΈ° λ•λ¬Έμ΄λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/b6e8ff82-b2e4-409e-ab71-39fd8d6086d7)

import κ²°κ³Ό .tfstate νμΌμ΄ μƒμ„±λμ—λ‹¤. κ°•μμ—μ„λ” import λ§μΌλ΅ μ½”λ“ μƒμ„±μ΄ μ΄λ£¨μ–΄μ§€μ§€λ” μ•λ”λ‹¤κ³  ν•μ€λ”λ°, λ²„μ „μ΄ μ—…κ·Έλ μ΄λ“λλ©΄μ„ μλ™μΌλ΅ state νμΌμ΄ μƒμ„±λ κ²ƒ κ°™λ‹¤.

κ·Έλλ„ νΉμ‹ λ¨λ¥΄λ‹ `terraform plan` -> `terraform apply`λ¥Ό ν†µν•΄ λ°±μ—”λ“μ state νμΌκ³Ό μ‹¤μ  μΈν”„λΌ μƒνƒλ¥Ό μΌμΉμ‹ν‚¬ κ²ƒμ΄λ‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/e3d25948-c366-41b9-9f9a-2fa127069605)

ν…λΌνΌμ„ μ‚¬μ©ν•¨μ— μμ–΄μ„ κ°€μ¥ μ¤‘μ”ν• κ²ƒμ€ state νμΌκ³Ό μ‹¤μ  μΈν”„λΌ μ •λ³΄λ¥Ό μΌμΉμ‹ν‚¤λ” κ²ƒμ΄λ‹¤. κ·Έλμ„ state νμΌμ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ μ‹¤μ  μΈν”„λΌμ™€μ λ³€κ²½μ‚¬ν•­μ„ λ³΄μ—¬μ£Όλ” `plan` λ…λ Ήμ–΄λ¥Ό μ κ·Ήμ μΌλ΅ ν™μ©ν•΄μ•Ό ν•λ‹¤.

# Reference

[μ²μ μ‹μ‘ν•λ” Infrastructure as Code: AWS & ν…λΌνΌ](https://www.inflearn.com/course/%EB%8D%B0%EB%B8%8C%EC%98%B5%EC%8A%A4-%ED%85%8C%EB%9D%BC%ED%8F%BC-aws)

# History

π“ 2023-12-22: ν…λΌνΌ κµ¬μ„±μ”μ† λ° κΈ°λ³Έ λ…λ Ήμ–΄ μ •λ¦¬   
π“ 2023-12-26: ν…λΌνΌ μ‘λ™ μ›λ¦¬ μ¶”κ°€
π“ 2024-3-4: ν…λΌνΌμ΄ μΈν”„λΌλ¥Ό μΈμ‹ν•λ” λ°©λ²• μλ»λ λ¶€λ¶„ μμ • λ° λ‚΄μ© μ¶”κ°€