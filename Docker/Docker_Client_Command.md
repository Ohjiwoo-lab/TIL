# 기본적인 도커 클라이언트 명령어

## 컨테이너 생성 및 실행

이미지에는 애플리케이션이 컨테이너에서 실행되기 위해 필요한 모든 것이 저장되어 있다. 대표적으로 다음 2가지가 필요하다.

- 컨테이너 시작 시 실행될 명령어 (이미지 시작 명령어)
- 애플리케이션 파일 스냅샷

도커 이미지로부터 컨테이너가 생성되어 시작될 때에는 다음과 같은 작업이 도커 엔진에 의해 수행된다.

1. 컨테이너가 생성되고 CPU, 메모리, 하드디스크, 네트워크 대역폭 등 리소스가 할당된다.

2. 애플리케이션 파일 스냅샷이 하드디스크에 저장된다.

3. 이미지 시작 명령어가 운영체제 커널에 의해 실행된다.

4. 애플리케이션 파일 스냅샷이 메모리에 적재되고 프로그램이 실행된다.

위의 작업을 모두 수행해주는 것이 `run` 명령어이다. 다음과 같이 사용하면 된다.

```
docker run hello-world
```

이러면 hello-world 파일 스냅샷이 하드디스크에 저장되고 시작 명령어가 실행된다.

그런데 매번 컨테이너를 생성하면서 실행하지 않고, 이미 생성되어 있는 컨테이너를 실행하고 싶을 수도 있다. 그래서 파일 스냅샷을 하드디스크에 저장하는 `create` 명령어와 이미지 시작 명령어를 실행하는 `start` 명령어도 존재한다. 다음과 같이 실행하면 된다.

```
docker create hello-world
docker start <컨테이너 이름/아이디>
```

이미지를 통해 컨테이너를 생성하고 생성한 컨테이너를 실행하는 것이다. 위의 코드는 정확히 `docker run hello-world`와 동일하다.

## 컨테이너 중지

컨테이너를 중지하기 위해선 `stop`과 `kill`을 이용할 수 있다. 이 둘의 차이점은 다음과 같다.

- stop: `SIGKILL`을 보내서 프로세스를 중지하기 전에 `SIGTERM`을 통해 정리하는 시간을 확보해준다. 그래서 현재 진행하고 있던 작업은 모두 완료한 뒤 중지할 수 있다.

- kill: 정리하는 시간 없이 바로 `SIGKILL`을 통해 프로세스를 즉각 중지시킨다.

## 컨테이너에 명령어 실행

컨테이너에 `ls`와 같은 명령어를 실행하기 위해서는 2가지 방법이 있다.

첫 번째는 `run` 명령어를 이용하는 것이다.

```
docker run alpine ls
```

위와 같은 명령어를 입력하면 `alpine`이라는 이미지를 이용하여 컨테이너를 실행하는데, 이미지의 시작 명령어를 실행하는 것이 아니라 `ls` 명령어를 실행한다. 즉 컨테이너를 만들고 그 속에서 `ls` 명령어를 실행하는 것이다.

`ls`는 하드디스크의 파일 목록을 검색하는 명령어이기 때문에 하드디스크에 저장되는 이미지 파일 스냅샷이 ls 명령어를 지원해야 한다. alpine의 경우 경량 리눅스 이미지이기 때문에 지원하지만, hello-world 같은 아주 간단한 이미지에서는 지원되지 않는다. 즉 이미지의 종류에 따라 사용할 수 있는 명령어 종류가 달라질 수 있다는 것이다.

두 번째는 `exec`를 이용하는 방식이다. run 명령어는 무조건 컨테이너를 생성해야만 했다. 그런데 매번 컨테이너를 생성하는 것은 너무 많은 리소스를 낭비하는 행동일 것이다. 그래서 exec 명령어는 실행 중인 컨테이너에 명령어를 전달한다.

```
docker exec <컨테이너 아이디> ls
```

이렇게 하면 이전에 run 명령어를 이용할 때와 동일한 결과가 나오지만 컨테이너가 새로 생성되지 않는다는 장점이 있다.

만약 많은 수의 명령어를 컨테이너에 전달해야 한다면, 매번 `docker exec <컨테이너 아이디>`까지 입력해야 하기 때문에 번거로울 수 있다. 그럴 때는 쉘 환경으로 접속하면 된다.

```
docker exec -it <컨테이너 아이디> sh
```

`-it`는 컨테이너에 접속한 후에 계속 명령어를 입력할 수 있게 하는 옵션이다. 마지막에 `sh`로 입력하게 되면 쉘 환경에서 원하는 명령어를 마음껏 입력할 수 있다. 파일 생성 및 환경 변수 설정과 같은 작업도 가능해진다.

# Reference

[따라하며 배우는 도커와 CI환경](https://www.inflearn.com/course/%EB%94%B0%EB%9D%BC%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8F%84%EC%BB%A4-ci/dashboard)

# History

📌 2024-5-8: Docker 클라이언트 기본 명령어 정리   