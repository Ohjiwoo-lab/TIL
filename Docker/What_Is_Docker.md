# Docker란?

Docker는 컨테이너를 사용할 수 있게 해주는 오픈소스 플랫폼이다. 애플리케이션을 실행하기 위해 필요한 것들이 굉장히 많다. 아주 간단한 프로그램이라 하더라도 라이브러리, 코드, 런타임, 시스템 도구 등이 필요하고, 이 중에 하나만 없어도 오류가 발생한다. 이러한 문제점을 해결하기 위해 애플리케이션 실행에 필요한 모든 것들을 하나로 묶어두기 위한 것이 컨테이너이다. 이제 컨테이너만 있다면 어느 환경에서든 동일하게 애플리케이션을 실행할 수 있다.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/a1e0645e-3ed7-428c-b2ba-cbe2f80523da)   
출처: [도커와 도커 컨테이너의 이해 ](https://www.itworld.co.kr/news/110748)

예전에는 1개의 컴퓨터에서 1개의 운영체제를 사용하여 프로그램을 사용했었다. 이것이 안정적이기는 하지만 비효율적이고 자원의 낭비가 심했다. 그래서 자원을 최대한 활용해보자는 차원에서 `가상화` 기술이 등장하였고, 가상화 소프트웨어인 하이퍼바이저를 이용하여 1개의 컴퓨터에서 여러 운영체제를 운영할 수 있게 되었다.

하지만 하이퍼바이저를 이용한 가상화 기술은 게스트 운영체제를 별도로 부팅해야 하기 때문에 오버헤드가 크다는 단점이 있었다. 이에 따라 보다 경량화된 형태로 애플리케이션 사이의 독립성을 보장해줄 수 있는 방안으로 컨테이너의 개념이 등장하였다. 컨테이너는 도커가 등장하기 전부터 존재했던 개념이다. 리눅스 운영체제 수준에서 가상화를 제공해주는 LXC가 있다. LXC는 cgroups와 네임스페이스를 기반으로 구현되어 있다. 이제 LXC의 개념을 이용하여 컨테이너를 보다 효율적이고 편리하게 사용할 수 있도록 도커라는 툴이 등장하게 된 것이다.

기존의 가상머신 환경에서는 가상머신 마다 운영체제가 존재했다. 그런데 도커 컨테이너는 별도의 운영체제를 포함하고 있지 않다. 컴퓨터에 설치되어 있는 호스트 운영체제를 공유하며, 애플리케이션에 필요한 라이브러리만 포함하고 있어서 보다 경량화되었다고 볼 수 있다. 운영체제를 부팅할 필요가 없어졌기 때문에 훨씬 속도도 빠르고 이식성도 좋아졌다.

## 이미지와 컨테이너

도커 이미지와 컨테이너의 관계를 살펴보자.

도커 이미지는 애플리케이션 코드, 사용된 라이브러리, 런타임 환경, 시스템 설정 등 애플리케이션 실행에 필요한 모든 종속성을 포함하고 있는 가볍고 독립적이며 실행가능한 소프트웨어 패키지이다. 그리고 이 도커 이미지가 실제로 도커 엔진에서 실행되었을 때 컨테이너라고 부른다. 그래서 컨테이너를 이미지의 인스턴스라고도 한다. 도커 이미지를 실행하면 도커 엔진의 컨테이너 속에서 애플리케이션이 실행되는 것이다.

그러면 도커 이미지는 어디에 보관될까? 도커 이미지는 Docker Hub라는 곳에서 저장하고 있다. Docker Hub는 퍼블릭 레파지토리여서 누구나 등록된 이미지를 사용할 수 있고 이미지를 등록할 수도 있다. 실제로 Docker Hub에서 이미지를 가져와서 실행해보자!

> 만약 `docker: permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock` 이러한 오류가 발생한다면, 리눅스 환경에서 도커를 실행할 권한이 없다는 뜻이다.   
> 
> => 해결 방법: `sudo usermod -aG docker $USER`을 통해 사용자에게 도커 권한을 부여하면 된다.
> 
> 출처: https://seulcode.tistory.com/557

현재 도커에 저장되어 있는 이미지를 확인해보자.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/f7434bba-935d-4972-8789-ce2effc6f7d3)

아직 아무것도 없는 것을 확인할 수 있다. 그러면 `hello-world`라는 이미지를 가져와서 실행해보자.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/a33f2ceb-d65b-4ab5-a051-569d91c54e32)

제대로 `hello-world`라는 이미지에 패키징된 애플리케이션이 실행되었다. 해당 애플리케이션은 그저 위에 보이는 문장들을 출력해주는 기능을 한다. 이런 단순한 애플리케이션도 코드만 가지고 실행하려고 하면 설치해야 할 것들이 많았을 것이다. 도커 이미지를 이용해 그러한 불필요한 수고를 덜어낼 수 있었다.

첫 줄에 보면 다음과 같이 표시되어 있다.

```
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
c1ec31eb5944: Pull complete
```

현재 도커에 아무런 이미지가 포함되어 있지 않았기 때문에 `hello-world:latest` 이미지를 찾을 수 없다고 나온다. 그런 후 해당 이미지를 Pulling 한다고 되어잇고, Pull이 완료되었다고 나온다. 이 작업은 Docker Hub로부터 이미지를 불러오는 작업이다. 이미지를 불러와서 로컬의 이미지 캐시 보관 장소에 이미지를 저장한다.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/32b5c686-db8e-4a7e-94d0-dbcc6543cbb3)

다시 확인해보면 13.26KB인 이미지 1개가 저장되어 있다. 도커 엔진은 이 이미지 캐시 보관 장소로부터 이미지가 있는지 먼저 확인한 뒤, 없으면 자동으로 Docker Hub로부터 이미지를 가져와서 저장해둔다. 그래서 한 번 더 같은 이미지를 실행하면 이미 로컬 캐시에 저장되어 있기 때문에 Docker Hub로부터 불러오는 작업은 수행하지 않을 것이다.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/77bf4272-bdab-4f17-abb0-7a04786f78a3)

다시 실행하면 바로 애플리케이션이 실행되는 것을 확인할 수 있다.

컨테이너는 이미지의 인스턴스라고 했다. 이미지가 실행하면 컨테이너가 되는 것이다. 지금까지 hello-world 이미지를 총 2번 실행했다.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/24c8288d-0219-44cd-b42d-bb7dc1408a97)

그래서 이미지는 1개이지만, 컨테이너는 2개임을 알 수 있다. 아주 간단한 이미지여서 실행과 동시에 종료되었기 때문에 ACTIVE 상태인 것은 없는 것이다.

# Reference

[따라하며 배우는 도커와 CI환경](https://www.inflearn.com/course/%EB%94%B0%EB%9D%BC%ED%95%98%EB%A9%B0-%EB%B0%B0%EC%9A%B0%EB%8A%94-%EB%8F%84%EC%BB%A4-ci/dashboard)

# History

📌 2024-4-22: Docker와 컨테이너 개념 정리   