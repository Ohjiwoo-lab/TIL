# Kinesis Data Stream

Kinesis Data Streamì€ IoT ë””ë°”ì´ìŠ¤ ë˜ëŠ” Click Streams ë“±ìœ¼ë¡œë¶€í„° ëŒ€ê·œëª¨ë¡œ ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•œ í›„ ì €ì¥í•˜ëŠ” ì„œë¹„ìŠ¤ì´ë‹¤. ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤ì´ê¸° ë•Œë¬¸ì— 200ms ì´í•˜ì˜ ì§§ì€ ì§€ì—°ì‹œê°„ì´ ì†Œìš”ëœë‹¤. ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ëŠ” `ìƒ¤ë“œ`ì— ìˆœì„œëŒ€ë¡œ ë‚˜ë‰˜ì–´ ì €ì¥ëœë‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/90e61b58-951a-475e-83e0-75a1eb5e412d)

ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ë¥¼ ìƒì‚°ìê°€ ìˆ˜ì§‘í•˜ì—¬ ìƒ¤ë“œì— ì €ì¥í•œë‹¤. ì´ë•Œ ì–´ëŠ ìƒ¤ë“œì— ì €ì¥ë˜ëŠ”ì§€ëŠ” `Partition Key`ë¥¼ ì´ìš©í•˜ì—¬ ê²°ì •í•  ìˆ˜ ìˆë‹¤. ê°™ì€ Partition Keyë¥¼ ê°€ì§„ ë°ì´í„°ëŠ” ì–¸ì œë‚˜ ê°™ì€ ìƒ¤ë“œì— ë“¤ì–´ê°ì„ ë³´ì¥í•œë‹¤. Partition Keyì— ëŒ€í•´ Kinesisì—ì„œ í•´ì‹œ í•¨ìˆ˜ë¥¼ ì ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë³´ë‚¼ ìƒ¤ë“œë¥¼ ê²°ì •í•˜ê²Œ ëœë‹¤.

ìƒ¤ë“œì— ë°ì´í„°ê°€ ì €ì¥ë˜ê³  ë‚˜ë©´ ë³´ì¡´ê¸°ê°„ì´ ëë‚  ë•Œê¹Œì§€ ì ˆëŒ€ ì‚­ì œí•  ìˆ˜ ì—†ë‹¤. ë³´ì¡´ê¸°ê°„ì€ ê¸°ë³¸ì ìœ¼ë¡œ 24ì‹œê°„ì¸ë°, ìµœëŒ€ 365ì¼ê¹Œì§€ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. SQSì™€ ë‹¬ë¦¬ ì†Œë¹„ë˜ì–´ë„ ë°ì´í„°ê°€ ì‚­ì œë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ë™ì¼í•œ ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ì— ëŒ€í•´ ì—¬ëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì†Œë¹„í•  ìˆ˜ ìˆë‹¤. ë˜í•œ ë³´ê´€ëœ ë°ì´í„°ë¥¼ reprocess, reply í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

Kinesisì˜ ìš©ëŸ‰ì— ëŒ€í•œ 2ê°€ì§€ ëª¨ë“œê°€ ì¡´ì¬í•œë‹¤.

1. On-demand: ìš©ëŸ‰ ê³„íšì´ í•„ìš”ì—†ê³ , ì²˜ë¦¬ëŸ‰ì— ë”°ë¼ ìë™ìœ¼ë¡œ ìƒ¤ë“œë¥¼ ìŠ¤ì¼€ì¼ë§í•œë‹¤.

2. Provisioned: ì§ì ‘ ìƒ¤ë“œë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.

Kinesis Data Streamì€ ìƒ¤ë“œì˜ ê°œìˆ˜ì— ë”°ë¼ ì²˜ë¦¬ëŸ‰ì´ ë‹¬ë¼ì§„ë‹¤. ì²˜ë¦¬ëŸ‰ì´ ë§ì•„ì§€ë©´ ìƒ¤ë“œë¥¼ ì¶”ê°€í•´ì•¼ í•˜ê³ , ì²˜ë¦¬ëŸ‰ì´ ì ì–´ì§€ë©´ ìƒ¤ë“œë¥¼ ì¤„ì—¬ì•¼ í•œë‹¤.

## ìƒì‚°ìì™€ ì†Œë¹„ì

Kinesis Data Streamì˜ ìƒì‚°ìì™€ ì†Œë¹„ìê°€ ë  ìˆ˜ ìˆëŠ” í›„ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/6ab9bc8f-9baf-4584-a257-83b837e291fc)

ìƒì‚°ìëŠ” ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•´ì„œ Kinesis Streamì˜ ìƒ¤ë“œë¡œ ë³´ë‚´ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ê³ , ì†Œë¹„ìëŠ” Kinesis Streamìœ¼ë¡œë¶€í„° ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ë¥¼ ê°€ì ¸ê°€ì„œ ì²˜ë¦¬í•˜ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‹¤. í•˜ë‚˜ì”© ë¬´ì—‡ì¸ì§€ ì‚´í´ë³´ì.

### Producer

1. AWS SDK

    ê°€ì¥ ê°„ë‹¨í•˜ê³  ì¼ë°˜ì ì¸ ìƒì‚°ìì´ë‹¤. Java, Python, Node.js ë“± ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ì§€ì›í•˜ê³  ìˆë‹¤.

2. Kinesis Producer Library (KPL)

    ì´ëŠ” Kinesis Data Streamì— ëŒ€í•œ ë†’ì€ ì“°ê¸° ì²˜ë¦¬ëŸ‰ì„ ì œê³µí•´ì£¼ëŠ” ì‚¬ìš©ì ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. ê°œë°œìê°€ ìƒì‚°ì ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í¸ë¦¬í•˜ê²Œ ê°œë°œí•˜ê¸° ìœ„í•œ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. ë‹¤ë§Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì¶”ê°€ ì§€ì—°ì‹œê°„ì´ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì§€ì—°ì‹œê°„ì„ í—ˆìš©í•  ìˆ˜ ì—†ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì€ SDKë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

3. Kinesis Agent

    KPL ê¸°ë°˜ì˜ ì—ì´ì „íŠ¸ì´ë‹¤. ë¡œê·¸ íŒŒì¼ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ì´ë¥¼ Kinesis Data Streamê³¼ Kinesis Data Firehoseë¡œ ì§ì ‘ ì „ì†¡í•  ìˆ˜ ìˆë‹¤. EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ë¡œê·¸íŒŒì¼ì„ ê°€ì ¸ì™€ì„œ Streamìœ¼ë¡œ ì „ì†¡í•˜ê³  ì‹¶ì€ ê²½ìš° ìœ ìš©í•œ ì„œë¹„ìŠ¤ì´ë‹¤.

ìƒì‚°ìëŠ” ìƒ¤ë“œ ë‹¹ 1MB/s ë˜ëŠ” 1000 messages/së¥¼ Streamì— ì‘ì„±í•  ìˆ˜ ìˆë‹¤. ë§Œì•½ ë„ˆë¬´ ë§ì€ ì“°ê¸° ì‘ì—…ì´ ì¼ì–´ë‚˜ê²Œ ë  ê²½ìš° `ProvisionedThroughputException` ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ”ë°, ì´ëŠ” ìƒ¤ë“œì˜ ê°œìˆ˜ë¥¼ ëŠ˜ë¦¼ìœ¼ë¡œì¨ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

### Consumer

1. AWS SDK

    ìƒì‚°ìì™€ ë§ˆì°¬ê°€ì§€ë¡œ SDKë¥¼ ì´ìš©í•˜ì—¬ ì†Œë¹„ì ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì œì‘í•  ìˆ˜ ìˆë‹¤.

2. Lambda

    `ì´ë²¤íŠ¸ ì†ŒìŠ¤ ë§¤í•‘`ì„ í†µí•´ Lambda í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤. Kinesis Streamì—ì„œ ì´ë²¤íŠ¸ ì†ŒìŠ¤ ë§¤í•‘ì„ í†µí•´ Lambdaë¥¼ í˜¸ì¶œí•˜ë©´, ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. ë§Œì•½ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ S3 ë²„í‚·ì— ì €ì¥í•˜ê³  ì‹¶ë‹¤ë©´, ëŒë‹¤ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤.

    > ì´ë²¤íŠ¸ ì†ŒìŠ¤ ë§¤í•‘ì´ë€, Lambda í•¨ìˆ˜ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•Šë”ë¼ë„ ì´ë²¤íŠ¸ ì†ŒìŠ¤ë¡œë¶€í„° Lambdaë¥¼ ê°„ì ‘ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. LambdaëŠ” Kinesis Data Streams, SQS, MQ ë“±ì˜ ì´ë²¤íŠ¸ ì†ŒìŠ¤ë¡œë¶€í„° ì´ë²¤íŠ¸ê°€ ìˆëŠ”ì§€ë¥¼ Long Pollingì„ í†µí•´ í™•ì¸í•œë‹¤. ê·¸ë¦¬ê³  ì´ë²¤íŠ¸ê°€ ìˆìœ¼ë©´ ì´ë²¤íŠ¸ë¥¼ Poll í•´ì™€ì„œ ì²˜ë¦¬í•œë‹¤. ì´ëŠ” ì´ë²¤íŠ¸ ì†ŒìŠ¤ì¸ Kinesis, SQS, MQì—ì„œ ëŒë‹¤ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ì•Œì•„ì„œ ì´ë²¤íŠ¸ë¥¼ ê°€ì ¸ì™€ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ë°©ì‹ì´ë‹¤.

3. Kinesis Client Library (KCL)

    ìŠ¤íŠ¸ë¦¼ ë°ì´í„°ë¥¼ ë³‘ë ¬ë¡œ ì½ì„ ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. ë³‘ë ¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì²´í¬í¬ì¸íŠ¸ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤. KCL ì• í”Œë¦¬ì¼€ì´ì…˜ì€ Kinesis Data Streamìœ¼ë¡œë¶€í„° ë°ì´í„°ë¥¼ ì½ì€ í›„, ì–´ë””ê¹Œì§€ ì½ì—ˆëŠ”ì§€ì— ëŒ€í•œ ì§„í–‰ìƒí™©ì„ DynamoDBì— ë‚¨ê¸´ë‹¤.(ì²´í¬í¬ì¸íŠ¸) ê·¸ëŸ¬ë©´ ë‹¤ë¥¸ KCL ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì´ ì§„í–‰ìƒí™©ì„ í™•ì¸í•˜ì—¬ ì•„ì§ ì½íˆì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ì—¬ëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‹œì— ì‹¤í–‰ë˜ì–´ë„ ê°™ì€ ë°ì´í„°ë¥¼ ì—¬ëŸ¬ ë²ˆ ì½ì§€ ì•Šê²Œ í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Scale-out í™•ì¥ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤.

4. Kinesis Data Analytics

    Kinesisì—ì„œ ë°ì´í„° ë¶„ì„ì„ í•˜ê¸° ìœ„í•œ ì„œë¹„ìŠ¤ì´ë‹¤. Kinesis Streamìœ¼ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•œ ë’¤ Kinesis Firehoseë‚˜ Kinesis Streamìœ¼ë¡œ ê²°ê³¼ë¥¼ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.

5. Kinesis Data Firehose

    ì´ëŠ” ë°ì´í„°ë¥¼ ì²˜ë¦¬í•œ ë’¤ ì „ì†¡í•˜ê¸° ìœ„í•œ Kinesis ì„œë¹„ìŠ¤ì´ë‹¤. ë ˆì½”ë“œë¥¼ ìœ„í•œ ë²„í¼ê°€ ì¡´ì¬í•œë‹¤. ì„¤ì •í•œ Buffer Size ë§Œí¼ ë°ì´í„°ê°€ ì±„ì›Œì¡Œì„ ë•Œ, ê·¸ë¦¬ê³  Buffer Time ë§Œí¼ ì‹œê°„ì´ ì§€ë‚¬ì„ ë•Œë§ˆë‹¤ ë²„í¼ë¥¼ Flushí•œë‹¤. Flush í•  ë•Œì—ëŠ” 1ë¶„ ì •ë„ì˜ ì§€ì—°ì‹œê°„ì´ ë°œìƒí•˜ê³ , ë°°ì¹˜ ë‹¨ìœ„ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ëŒ€ë¬¸ì— ì¤€ ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤ë¼ê³  í•œë‹¤. Firehoseë„ Streamì˜ ì†Œë¹„ìê°€ ë  ìˆ˜ ìˆë‹¤.

    > ì´ì— ëŒ€í•´ì„œëŠ” ë”°ë¡œ ì •ë¦¬í•  ì˜ˆì •ì´ë‹¤.

ì†Œë¹„ìëŠ” 2ê°€ì§€ ëª¨ë“œê°€ ìˆë‹¤.

`Consumer Classic` ëª¨ë“œëŠ” ì†Œë¹„ìì˜ ê°œìˆ˜ì— ìƒê´€ì—†ì´ ìƒ¤ë“œ ë‹¹ 2MB/sì˜ ì½ê¸° ì²˜ë¦¬ëŸ‰ê³¼ 5 API Calls per second ì„ í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” ì†Œë¹„ìì˜ ê°œìˆ˜ë¥¼ ëŠ˜ë ¤ë„ ì²˜ë¦¬ëŸ‰ì´ ì¦ê°€í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì„±ëŠ¥ì„ ê°œì„ í•˜ê¸° ìœ„í•´ì„œ ìƒ¤ë“œë¥¼ ëŠ˜ë¦¬ëŠ” ë°©ë²•ë°–ì— ì—†ë‹¤.

`Consumer Enhanced Fan-Out` ëª¨ë“œëŠ” ìƒ¤ë“œ ë‹¹, ì†Œë¹„ì ë‹¹ 2MB/sì˜ ì²˜ë¦¬ëŸ‰ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤. ë”°ë¼ì„œ ì„±ëŠ¥ì„ ê°œì„ í•˜ê¸° ìœ„í•´ ìƒ¤ë“œë¥¼ ëŠ˜ë¦¬ëŠ” ê²ƒ ëŒ€ì‹  ì†Œë¹„ìë¥¼ ëŠ˜ë¦¬ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

> push modelì´ë¼ API Callì€ í•„ìš”í•˜ì§€ ì•Šë‹¤ê³  í•˜ëŠ”ë° ì•„ì§ ë¬´ìŠ¨ ì†Œë¦¬ì¸ì§€ ëª¨ë¥´ê² ë‹¤.

# Reference

[Udemy ê°•ì˜ - AWS Certified Solutions Architect Professional](https://www.udemy.com/course/aws-csa-professional/?couponCode=KRLETSLEARNNOW)

# History

ğŸ“Œ 2024-4-16: Kinesis Data Stream, ìƒì‚°ìì™€ ì†Œë¹„ì   
ğŸ“Œ 2024-4-24: ì´ë²¤íŠ¸ ì†ŒìŠ¤ ë§¤í•‘ ì¶”ê°€ ë‚´ìš© ì •ë¦¬   