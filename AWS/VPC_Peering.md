# VPC Peering

VPC Peeringì´ë€ 2ê°œì˜ VPCë¥¼ AWSì˜ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ë§ì„ ì´ìš©í•˜ì—¬ í”„ë¼ì´ë¹—í•˜ê²Œ ì—°ê²°í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì´ë‹¤. VPCëŠ” Virtual Private Cloudì´ê¸° ë•Œë¬¸ì— VPC ì™¸ë¶€ì—ì„œì˜ ì ‘ê·¼ì„ ê·¼ë³¸ì ìœ¼ë¡œ ì°¨ë‹¨í•œë‹¤. ê·¸ë˜ì„œ ì„œë¡œ ë‹¤ë¥¸ VPCì— ì†í•´ìˆëŠ” ë¦¬ì†ŒìŠ¤ë“¤ë¼ë¦¬ëŠ” í†µì‹ í•  ìˆ˜ ì—†ì—ˆë‹¤. í•˜ì§€ë§Œ VPC Peeringì„ ì´ìš©í•˜ë©´ ì„œë¡œ ë‹¤ë¥¸ VPCê°€ ë§ˆì¹˜ í•˜ë‚˜ì˜ VPCì¸ ê²ƒì²˜ëŸ¼ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ë¦¬ì†ŒìŠ¤ë“¤ë¼ë¦¬ í†µì‹ ì´ ê°€ëŠ¥í•´ì§„ë‹¤.

> ë¬¼ë¡  ì‹¤ì œë¡œ í†µì‹ ì´ ë˜ë ¤ë©´ ì„œë¸Œë„·ì— Routing Tableì„ ì—…ë°ì´íŠ¸í•´ì¤˜ì•¼ í•œë‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/47689152-f2b3-4359-9fbd-a9005e4399db)

VPC-Aì™€ VPC-B ì‚¬ì´ì— VPC Peeringì„ ì„¤ì •í•˜ë©´, VPC-Aì— ìˆëŠ” ëª¨ë“  ë¦¬ì†ŒìŠ¤ë“¤ì€ VPC-Bì˜ ëª¨ë“  ë¦¬ì†ŒìŠ¤ì™€ ììœ ë¡­ê²Œ í†µì‹ í•  ìˆ˜ ìˆë‹¤. VPC-Aì™€ VPC-Bê°€ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì´ ë˜ì—ˆë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤. ê·¸ë˜ì„œ Peeringì„ ì„¤ì •í•˜ë ¤ëŠ” VPCëŠ” CIDRê°€ ê²¹ì¹˜ë©´ ì•ˆ ëœë‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/0b5bfe68-01d2-489e-9564-de1ab6fdd794)

ë§Œì•½ VPC-Aì˜ CIDRì™€ VPC-Bì˜ CIDRì´ 172.16.0.0/16ìœ¼ë¡œ ë™ì¼í•˜ë‹¤ë©´, í•´ë‹¹ ì„œë¸Œë„·ì— ìƒì„±ëœ ë¦¬ì†ŒìŠ¤ì˜ IPê°€ ë™ì¼í•œ ê²½ìš°ê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤. ê·¸ë¦¼ì—ì„œì²˜ëŸ¼ EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ IPê°€ ë™ì¼í•˜ê²Œ 172.16.0.5ì¼ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤. ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ ì†ì—ì„œëŠ” ê°™ì€ ì‚¬ì„¤ IPë¥¼ ê°€ì§ˆ ìˆ˜ ì—†ë‹¤. í•´ë‹¹ IPë¡œ íŠ¸ë˜í”½ì´ ì „ì†¡ë˜ë©´ ì–´ëŠ ë¦¬ì†ŒìŠ¤ë¡œ íŠ¸ë˜í”½ì„ ì „ë‹¬í•  ì§€ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ëŸ°ë° VPC Peeringì„ ì„¤ì •í•˜ë©´ ë…¼ë¦¬ì ìœ¼ë¡œ ë™ì¼í•œ ë„¤íŠ¸ì›Œí¬ê°€ ë˜ê¸° ë•Œë¬¸ì— ì´ëŸ¬í•œ ê²½ìš°ëŠ” í° ë¬¸ì œê°€ ë  ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ VPC Peeringì„ ì„¤ì •í•˜ë ¤ë©´ IPv4 CIDRê°€ ê²¹ì¹˜ì§€ ì•Šì•„ì•¼ í•œë‹¤.

VPC Peeringì€ 2ê°œì˜ VPC ê°„ì— ì—°ê²°í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë©´ 3ê°œë¥¼ ì—°ê²°í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ? Peeringì€ Transitiveê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤. Aì™€ Bê°€ ì—°ê²°ë˜ê³ , Bì™€ Cê°€ ì—°ê²°ë˜ì—ˆë‹¤ê³  í•´ì„œ Aì™€ Cë„ ì—°ê²°ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ëŠ” ê²ƒì´ë‹¤. ê·¸ë˜ì„œ 3ê°œë¥¼ ë™ì‹œì— ì—°ê²°í•˜ê³  ì‹¶ë‹¤ë©´ 3ê°œì˜ Peering ì—°ê²°ì„ ì„¤ì •í•´ì•¼ í•œë‹¤.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/2ae367b6-e66b-47cf-b248-3efd1f3a1162)

## Longest Prefix Match

ê·¸ë ‡ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì€ ì•„í‚¤í…ì²˜ëŠ” ê°€ëŠ¥í• ê¹Œ?

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/a109d212-372f-4e54-bfe0-41ce8042e477)

ê°€ëŠ¥í•˜ë‹¤. Peeringì€ Transitiveê°€ ë¶ˆê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— VPC-Aì™€ VPC-BëŠ” ì„œë¡œ í†µì‹ í•  ìˆ˜ ì—†ë‹¤. ê·¸ë˜ì„œ CIDRì´ ë™ì¼í•˜ë”ë¼ë„ ë¬¸ì œë˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ëŸ¬ë©´ VPC-Cì—ì„œ 172.16.0.5ë¡œ íŠ¸ë˜í”½ì„ ë³´ëƒˆì„ ë•Œ VPC-Aì™€ VPC-B ì¤‘ ì–´ëŠ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì „ë‹¬ë ê¹Œ? ì´ëŠ” VPC-Cì˜ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠëƒì— ë”°ë¼ ë‹¬ë¼ì§„ë‹¤.

ë¼ìš°íŒ… í…Œì´ë¸”ì—ì„œ 172.16.0.0/16ì— í•´ë‹¹í•˜ëŠ” íŠ¸ë˜í”½ì€ VPC-Bë¡œ ë³´ë‚´ë˜, 172.16.0.5/32ì— í•´ë‹¹í•˜ëŠ” íŠ¸ë˜í”½ì€ VPC-Aë¡œ ë³´ë‚´ë¼ê³  ëª…ì‹œí•´ë³´ì. ê·¸ëŸ¬ë©´ 172.16.0.5ë¡œ í–¥í•˜ëŠ” íŠ¸ë˜í”½ì€ VPC-Aë¡œ ì „ë‹¬ë˜ê³ , ê·¸ ì™¸ì˜ ë‚˜ë¨¸ì§€ 172.16.0.7, 172.16.0.8 ë“±ì€ VPC-Bë¡œ ì „ë‹¬ëœë‹¤. ì´ë ‡ê²Œ ë˜ëŠ” ì´ìœ ëŠ” `Longest Prefix Match`ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ê°€ì¥ êµ¬ì²´ì ì¸ ë¼ìš°íŒ… ê²½ë¡œê°€ ìš°ì„ ìˆœìœ„ê°€ ë†’ë‹¤. 172.16.0.5/32ëŠ” ê²½ìš°ì˜ ìˆ˜ê°€ 1ê°œì´ê³ , 172.16.0.0/16ì€ ê²½ìš°ì˜ ìˆ˜ê°€ 65,531ê°œì´ê¸° ë•Œë¬¸ì— 172.16.0.5/32ê°€ ìš°ì„ ì‹œ ëœë‹¤. ê·¸ë˜ì„œ 172.16.0.5ëŠ” 172.16.0.0/16ì— ì†í•¨ì—ë„ VPC-Bê°€ ì•„ë‹Œ VPC-Aë¡œ ë³´ë‚´ì§ˆ ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤.

## Edge to Edge Routing

VPC Peeringì€ Site-to-Site VPN, Direct Connect, IGW, NAT, Gateway VPC Endpointì— ëŒ€í•œ Edge to Edge Routingì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤. VPC ê°„ì— Transitiveê°€ ì„±ë¦½í•˜ì§€ ì•Šë˜ ê²ƒê³¼ ë¹„ìŠ·í•œ ê°œë…ì´ë‹¤. ê·¸ë¦¼ì„ í†µí•´ ì‚´í´ë³´ì.

### ë¶ˆê°€ëŠ¥í•œ ì¡°í•©

1. Site-to-Site VPN/Direct Connect

    ![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/4f8a7bf3-2fbd-4334-aff6-09b3bd7fd41d)

    VPC-Bì™€ ì˜¨í”„ë ˆë¯¸ìŠ¤ ë°ì´í„°ì„¼í„° ê°„ì— Site-to-Site VPN ì—°ê²°ì´ë‚˜ Direct Connectë¥¼ í†µí•´ ì—°ê²°ë˜ì–´ ìˆê³ , VPC-Bì™€ VPC-C ê°„ì— Peering ì—°ê²°ì´ ë˜ì–´ìˆë‹¤ê³  í•´ì„œ ì˜¨í”„ë ˆë¯¸ìŠ¤ì—ì„œ VPC-Aë¡œì˜ ë¼ìš°íŒ…ì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.

2. IGW/NAT

    ![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/4a0ca514-e572-4c64-8101-3a1bf85d54a5)

    VPC-Aì™€ VPC-Bê°€ Peering ì—°ê²°ì´ ë˜ì–´ ìˆë‹¤ê³  í•˜ë”ë¼ë„, VPC-Aì˜ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ìˆëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ê°€ VPC-Bì˜ NAT Gatewayë¥¼ í†µí•´ ì¸í„°ë„·ì— ì ‘ì†í•  ìˆ˜ ì—†ë‹¤. ì¸í„°ë„·ì— ì ‘ì†í•˜ê³  ì‹¶ë‹¤ë©´ VPC-Aì— ë³„ë„ë¡œ NAT Gatewayì™€ Internet Gatewayë¥¼ ì„¤ì¹˜í•´ì¤˜ì•¼ í•œë‹¤.

    VPC Peeringì„ í†µí•´ ë‹¤ë¥¸ VPC ë‚´ì— ìˆëŠ” NAT Gatewayì™€ Internet Gatewayë¥¼ ì´ìš©í•˜ì—¬ ì¸í„°ë„·ì— ì ‘ê·¼í•˜ë ¤ëŠ” ì‹œë„ëŠ” ì¢‹ì€ ì ‘ê·¼ì¸ ê²ƒì²˜ëŸ¼ ë³´ì¼ ìˆ˜ ìˆì§€ë§Œ, Peeringì´ Edge to Edge Routingì„ ì§€ì›í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì ì„ ëª…ì‹¬í•´ì•¼ í•œë‹¤.

3. Gateway VPC Endpoint

    ![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/159348be-fb57-4bcb-b4db-908ee54de797)

    VCP-Bì˜ í”„ë¼ì´ë¹— ì„œë¸Œë„·ì— ìˆëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ëŠ” VPC Endpoint Gatewayë¥¼ í†µí•´ VPC ì™¸ë¶€ì˜ S3ì— ë¹„ê³µê°œë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ VPC-Bì™€ Peering ì„¤ì •ë˜ì–´ ìˆëŠ” VPC-Aì— ìˆëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ëŠ” VPC-Bì˜ VPC Endpointë¥¼ í†µí•´ ì ‘ê·¼ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤. VPC Endpoint GatewayëŠ” VPC ì™¸ë¶€ë¡œ í™•ì¥ë  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤. ê·¸ë˜ì„œ VPN, Direct Connect, Transit Gateway, Peeringì— ì˜í•œ í™•ì¥ ê´€ê³„ì—ì„œëŠ” ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

### ê°€ëŠ¥í•œ ì¡°í•©

Gateway VPC EndpointëŠ” Peering ê´€ê³„ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆì§€ë§Œ, Interface VPC EndpointëŠ” ê°€ëŠ¥í•˜ë‹¤. 

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/fa22179f-a2cd-407e-9102-0fcaa443d7b0)

Interface VPC Endpointë¥¼ ì„¤ì •í•˜ë©´ ENIê°€ í”„ë¡œë¹„ì €ë‹ëœë‹¤. ê·¸ëŸ¬ë©´ Endpointì™€ S3 ê°„ì— PrivateLinkê°€ ìƒì„±ë˜ë©´ì„œ ë¹„ê³µê°œë¡œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆê²Œ ë˜ëŠ” ì›ë¦¬ì¸ ê²ƒ ê°™ë‹¤. ì´ëŠ” Gatewayì—ì„œì™€ ë‹¬ë¦¬ ENIë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì—°ê²°í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— VPC Peering ê´€ê³„ì—ì„œë„ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.

> PrivateLinkì— ëŒ€í•´ì„œëŠ” ì•„ì§ ì˜ ëª¨ë¥´ê² ë‹¤.. ê³„ì† ê³µë¶€í•˜ë©´ì„œ ì œëŒ€ë¡œ ì´í•´í•˜ë©´ ì •ë¦¬í•  ì˜ˆì •ì´ë‹¤.


# Reference

[Udemy ê°•ì˜ - AWS Certified Solutions Architect Professional](https://www.udemy.com/course/aws-csa-professional/?couponCode=KRLETSLEARNNOW)

# History

ğŸ“Œ 2024-4-14: VPC Peeringê³¼ Edge-to-Edge Routing   
ğŸ“Œ 2024-4-15: Edge-to-Edge Routing ì‚¬ë¡€ ì¶”ê°€ - VPC Endpoint Gatewayì™€ VPC Endpoint Interface   