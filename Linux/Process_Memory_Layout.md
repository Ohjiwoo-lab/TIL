# 프로세스 메모리 레이아웃

실행파일이 실제로 메모리에 적재되어 실행되고 있을 때를 `프로세스`라고 부른다. 프로세스마다 4GB의 가상 메모리가 할당되는데, 이 중 1GB는 커널을 위한 공간이고 나머지 3GB가 사용자 코드를 위한 영역이다. 사용자 코드 영역에 해당하는 3GB는 총 4가지로 구분되어 있다.

![image](https://github.com/Ohjiwoo-lab/TIL/assets/74577768/8dcabe4a-7435-4c19-9815-102e45089d41)   
출처: [프로세스 메모리 레이아웃](https://velog.io/@dahyeon405/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EB%A0%88%EC%9D%B4%EC%95%84%EC%9B%83)

text, data, stack, heap 영역으로 구분되어 있는 것을 확인할 수 있다. 하나씩 살펴보자.

1. text

    이는 프로그램 코드를 저장하는 부분이다. 따라서 읽기만 가능하고 쓰기 작업은 불가능한 공간이다. 프로세스가 실행되는 동안 절대 수정되지 않는다.

2. data

    글로벌 변수나 static 변수가 저장되는 부분이다. 또한 초기화 여부에 따라 초기화된 데이터 영역과 초기화되지 않은 데이터 영역(bss)로 구분된다. 초기화되지 않은 변수의 경우 커널에 의해 0 이나 null로 초기화된다.

3. stack

    함수의 지역변수가 저장되는 부분이다. stack은 높은 주소에서 낮은 주소 방향으로 증가한다는 특징을 가지고 있다. 함수의 호출 정보는 스택 프레임의 형태로 스택에 저장되며, 스택 프레임에는 함수의 지역 변수와 함수 실행을 마치고 돌아갈 위치 주소 등을 포함하고 있다.

4. heap

    동적 메모리 할당에 사용되는 메모리 영역이다. C언어의 경우 malloc 등의 함수로 할당하고, free 함수로 반환할 수 있다. heap은 낮은 주소에서 높은 주소 방향으로 증가하기 때문에 stack과 마주보게 된다.

프로세스 메모리 레이아웃에서 가장 중요한 점은 stack과 heap이 마주보며 증가한다는 것이다. 만약 하나의 프로그램에서 너무 큰 지역변수를 사용하게 되면 stack이 heap 영역을 침범하여 문제가 발생할 수 있고, 반대로 동적 메모리 할당을 너무 많이 하게 되면 heap이 stack 영역을 침범할 수 있다는 것이다. 그래서 프로그램을 작성할 때에는 이러한 메모리 레이아웃을 반드시 고려해야 할 것이다.

# History

📌 2024-5-30: 프로세스 메모리 레이아웃 정리   